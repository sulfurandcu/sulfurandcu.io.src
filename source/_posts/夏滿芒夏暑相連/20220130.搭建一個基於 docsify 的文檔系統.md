---
title: 搭建一個基於 docsify 的文檔系統
id: clnybw9vu001xbkrq6tmo3euo
date: 2022-01-30 22:29:19
tags: [docsify, 文檔系統]
categories: [效率提升]
---

![圖片加載失敗](architecture.png)
<center>・文檔系統架構圖・</center>

<!-- more -->

<br>

{% note info %}
`#web` http://127.0.0.1:3000
{% endnote %}

{% note info %}
`#ssh` localhost@127.0.0.1 📢 Password:password
{% endnote %}

{% note info %}
`#svn` http://svn.sulfurandcu.com/doc
{% endnote %}


## 系統架構

該系統由「一個代碼庫」「若干開發者」和「一臺服務器」組成。

### 代碼庫

代碼庫（SVN）中有一份文檔系統的源碼，裏面放着文檔系統的配置文件和各個項目的文檔文件。

### 開發者

開發者可以將 SVN 中的文檔系統源碼 checkout 至本地進行編輯、預覽。修改完畢後再提交回去。

### 服務器

服務器中也有一份從 SVN 中 checkout 出來的文檔系統源碼，這些內容被一個叫做文檔網站生成器的軟件動態轉換成網頁在 3000 端口以 HTTP 的形式對外提供訪問。這樣我們就可以通過瀏覽器以輸入 IP 地址加端口的形式訪問該文檔系統。另外該服務器上還運行着一個週期任務，這個任務每隔 15 分鐘（準確地說是在00分、15分、30分、45分的時候）**從 SVN 服務器中**更新一次文檔系統源碼。這樣就實現了文檔系統的自動更新。


## 使用說明

### 第一步：搭建環境

➀ 安裝「node.js」（一個基於 Chrome V8 引擎 的 JavaScript 運行時環境）

![圖片加載失敗](nodejs.png)

<center>
<a href="https://nodejs.org/" target="_blank">https://nodejs.org/</a>
</center><br>

{% grouppicture 6-4 %}
![圖片加載失敗](clnybw9vu001xbkrq6tmo3euo/nodejs.install.1.png)
![圖片加載失敗](clnybw9vu001xbkrq6tmo3euo/nodejs.install.2.png)
![圖片加載失敗](clnybw9vu001xbkrq6tmo3euo/nodejs.install.3.png)
![圖片加載失敗](clnybw9vu001xbkrq6tmo3euo/nodejs.install.4.png)
![圖片加載失敗](clnybw9vu001xbkrq6tmo3euo/nodejs.install.5.png)
![圖片加載失敗](clnybw9vu001xbkrq6tmo3euo/nodejs.install.6.png)
{% endgrouppicture %}

➁ 安裝「docsify」（一個使用 JavaScript 編寫的文檔網站生成器）

![圖片加載失敗](docsify.png)

<center>
<a href="https://docsify.js.org/" target="_blank">https://docsify.js.org/</a>
</center><br>

![圖片加載失敗](docsify.install.png)

<center>
npm i -g docsify-cli
</center>

{% note warning %}
安裝完 node.js 之後就可以使用 npm 指令安裝 docsify-cli 了
{% endnote %}

### 第二步：建立文檔

本文檔系統的框架已經建好並且已經提交至 SVN 服務器中：

![圖片加載失敗](document.cloud.png)

```
http://svn.sulfurandcu.com/doc
```

### 第三步：預覽效果

將上述文檔框架下載到本地，在其根目錄下執行 docsify serve 命令啓動一個本地服務器，就可以在本地預覽效果。

![圖片加載失敗](document.local.png)

![圖片加載失敗](document.serve.png)

<center>
docsify s
</center>

{% note warning %}
點擊 http://localhost:3000 即可預覽
{% endnote %}

### 第四步：進入正軌（編輯文檔、本地預覽、提交變更）

搭建好開發環境、將〈＃項目文檔〉下載到本地且知道怎麼預覽以後，就可以開始編輯、預覽、提交了，跟代碼的編輯、調試、提交沒什麼兩樣！

![圖片加載失敗](document.write.png)

文章使用輕量級標記語言 [markdown](https://www.markdownguide.org/basic-syntax/) 編寫；圖例使用 [draw.io](https://www.diagrams.net/) 繪製。


## 技術細節

這部分內容是文檔系統搭建的一些具體細節，在這裏記錄一下以供後續維護人員參考。需要說明的一點是，當前所使用的服務器運行的是 Windows 操作系統，因此以下操作均基於該操作系統。

### 自動更新

在 Windows 系統中，使用系統自帶的任務計劃程序實現：在〈計算機管理・任務計劃程序〉中創建一個週期任務，每隔一段時間執行一次以下腳本。

```py doc.py
import os

cmd = "svn up \"e:/＃文檔系統\" --non-interactive"
os.system(cmd)
```

{% note info %}
任務計劃程序配置好之後重啓電腦不影響其運行
{% endnote %}

### 手動更新

改動提交之後想立即更新至文檔服務器應該怎麼做呢？

遠程連接到服務器，手動執行一下 doc.py 即可。

### 手動啓動 docsify 服務

電腦關機後 docsify 服務也會隨之停止，因此每次開機後都要手動啓動 docsify 服務。我嘗試過啓動後自動運行，但是經常會執行失敗。


## 常見問題

### 服務器重啓後網頁無法訪問！

檢查 docsify 服務是否已經啓動。

### 修改提交之後內容沒有更新！

首先看週期更新任務是否正常執行。

如果週期更新任務沒有問題，那麼有可能是管理員同志的公司帳號密碼修改過，而文檔服務器中 svn 的訪問密碼沒有同步修改導致的。

{% note warning %}
系統會強制讓職工每隔兩個月修改一次密碼
{% endnote %}
